(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{289:function(t,e,n){var content=n(295);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(103).default)("7500e137",content,!0,{sourceMap:!1})},294:function(t,e,n){"use strict";n(289)},295:function(t,e,n){var o=n(102)(!1);o.push([t.i,'#editor-wrapper[data-v-00675c90]{font-size:1.1em;font-family:"Georgia",serif;border-radius:5px;height:calc(100vh - 120px);padding:80px 60px 200px;background-color:#fff}*[data-v-00675c90] h1,*[data-v-00675c90] h2,*[data-v-00675c90] h3,*[data-v-00675c90] h4,*[data-v-00675c90] h5,*[data-v-00675c90] h6{margin-top:1.5em;margin-bottom:.5em}*[data-v-00675c90] .comment{color:#5f9ea0;font-size:.8em}*[data-v-00675c90] .li-numbered{margin-left:3em;text-indent:-1em}*[data-v-00675c90] .li-bullet{margin-left:3em;text-indent:-1.5em}*[data-v-00675c90] .li-bullet:before{content:"•";margin-right:.5em}*[data-v-00675c90] .hide:not([data-show="+"]){position:fixed;z-index:-1;height:0}*[data-v-00675c90] .pre-hide:after{cursor:pointer;content:attr(data-show);color:#5f9ea0;font-family:sans-serif;font-size:.8em}*[data-v-00675c90] .post-hide,*[data-v-00675c90] .post-hide p,*[data-v-00675c90] .pre-hide,*[data-v-00675c90] .pre-hide p{display:inline;color:#ccc;font-size:.8em;cursor:pointer}*[data-v-00675c90] mark{background-color:gold}*[data-v-00675c90] .muffled{color:#ccc;background-color:#fff}*[data-v-00675c90] .muffled *{color:inherit;background-color:inherit;font-size:75%;border:0}*[data-v-00675c90] blockquote{border-left:4px solid #ddd;margin-left:1em;padding-left:1em}*[data-v-00675c90] .hr{color:#ccc;font-size:.8em;margin-top:3em;margin-bottom:2em;border:0;border-top:1px solid rgba(0,0,0,.1)}',""]),t.exports=o},313:function(t,e,n){var content=n(378);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(103).default)("1b7833da",content,!0,{sourceMap:!1})},316:function(t,e,n){"use strict";n.r(e);n(17),n(16),n(12),n(28),n(36),n(20),n(15),n(156),n(1),n(3);var o=n(291),r=n.n(o),c=(n(314),Object.assign),l=function(t){return(null==t?void 0:t.innerText)||(null==t?void 0:t.textContent)||""},d={props:{value:{default:""},readonly:{default:!1},disableFormatting:{default:!1},refresh:{default:!1},zoom:{default:100}},data:function(){var content=this.value||"",t=this.value.length;return{content:content,caretPosition:t,past:[{content:content,caretPosition:t}],future:[],afterUndoOrRedo:!1}},computed:{html:function(){var t,e=this,content=this.content;return content?(content=(content=(content=null===(t=content)||void 0===t?void 0:t.split(/\n\n|\n/).map((function(t){var n;t=t.trim();var o="p",r="",c=/^(#+)(\s)/,l=null===(n=c.exec(t))||void 0===n?void 0:n[1].length,d=/^(\d+)\.\s+/,h=/^([\*-])(\s+)/,f=/^(\[)(.+)(\])$/;if(!e.disableFormatting){var v=function(text){return'<span style="color: #ccc">'.concat(text,"</span>")};if(l?(o="h".concat(l),t=t.replace(c,v("$1")+"$2")):d.test(t)?(o="p",r=' class="li-numbered"',t=t.replace(d,'<span style="width: 1em; display: inline-block;"><strong>$1</strong>.&nbsp;</span>')):h.test(t)?(o="p",r=' class="li-bullet"',t=t.replace(h,"".concat(v("$1"),"$2"))):f.test(t)?t=t.replace(f,'<button class="btn btn-primary">'.concat(v("$1"),"$2").concat(v("$3"),"</button>")):/^(---)$/.test(t)?r=' class="hr"':/^(\/\/)(.+)$/.test(t)&&(r=' class="comment"'),t.trim()){var m=/\*\*([^*]+?)\*\*/g;m.test(t)&&(t=t.replace(m,"".concat(v("**"),"<strong>$1</strong>").concat(v("**"))));var y=/([^*])(\*)(\w[^*]+?)\2/g;y.test(t)&&(t=t.replace(y,"$1".concat(v("$2"),"<em>$3</em>").concat(v("$2"))));var w=/(\[)(.+?)(\]\(.+?\))/g;w.test(t)&&(t=t.replace(w,"".concat(v("$1"),'<a href="$4">$2</a>').concat(v("$3"))));var x=/^(=+) (.+?) \1$/;if(x.test(t)){var k,_=null===(k=t.match(x))||void 0===k?void 0:k[1].length;t=t.replace(x,"".concat(v("$1"),'<mark style="background-color: ').concat(["#b3ffd9","#ffffb3","#b3d9ff","#ffb3ff"][_-1],'"> $2 </mark>').concat(v("$1")))}var O=/^(>\s+)/;O.test(t)&&(o="blockquote",t=t.replace(O,"".concat(v("$1"))))}else r=' style="min-height: 1em"'}return"<".concat(o).concat(r,">").concat(t,"</").concat(o,">")})).join("\n")).replace(/\/\*[\s\S]*?\*\//g,'<div class="comment">$&</div>')).replace(/(<p>{{(\+?)<\/p>)([\s\S]*?)(<p>}}<\/p>)/g,'<div class="pre-hide">$1</div><div data-show="$2" class="hide muffled">$3</div><div class="post-hide">$4</div>'),this.$nextTick((function(){return document.querySelectorAll(".pre-hide").forEach((function(div){div.onclick=function(){var element=div.nextElementSibling;console.log(element),element.classList.toggle("hide"),div.setAttribute("data-show",element.classList.contains("hide")?"👀":"🙈")}}))})),content):""}},methods:{blur:function(t){document.activeElement!==t.target&&(this.content=this.value)},undo:function(){console.log("undo"),this.traverse("past","future")},redo:function(){console.log("redo"),this.traverse("future","past")},traverse:function(t,e){this[t].length&&(this[e].push(r.a.pick(this,["content","caretPosition"])),c(this,this[t].pop()),this.afterUndoOrRedo=!0)},setCaretPosition:function(t){var e=document.createTreeWalker(editor,NodeFilter.SHOW_ALL,(function(e){return t<=l(e).length?e.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:(t-=l(e).length,e.nodeType===Node.ELEMENT_NODE&&"block"===window.getComputedStyle(e).display&&t--,NodeFilter.FILTER_REJECT)})),n=e.nextNode(),o=document.createRange();n?(o.setStart(n,t),o.collapse(!0)):(o.selectNodeContents(editor),o.collapse(!1));var r=window.getSelection();r.removeAllRanges(),r.addRange(o)}},watch:{refresh:function(){this.content=this.value,this.past=[],this.future=[]},value:function(t){var e=this,n=this.readonly,o=this.disableFormatting,r=this.afterUndoOrRedo,content=this.content,c=this.caretPosition;if(!n&&!o){if(r)this.afterUndoOrRedo=!1;else{this.future=[],this.past.push({content:content,caretPosition:c});var d=document.getElementById("editor"),h=window.getSelection(),f=h.anchorNode,v=h.anchorOffset;if(!d.contains(f))return;c=0,document.createTreeWalker(d,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,(function(t){return t.contains(f)?l(t)===l(f)?("\n"===l(t)&&c++,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_SKIP:(c+=l(t).length,t.nodeType===Node.ELEMENT_NODE&&"block"===window.getComputedStyle(t).display&&c++,NodeFilter.FILTER_REJECT)})).nextNode(),c+=v,this.caretPosition=c}this.content=t,this.$nextTick((function(){return e.setCaretPosition(c)}))}}}},h=(n(294),n(65)),component=Object(h.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cool-shadow",style:{"background-color":t.readonly?"#eee":"#fff",overflowY:"scroll"},attrs:{id:"editor-wrapper"}},[n("div",{style:{outline:"none",zoom:t.zoom+"%"},attrs:{id:"editor",contenteditable:!t.readonly},domProps:{innerHTML:t._s(t.html)},on:{input:function(e){!t.readonly&&t.$emit("input",e.target.innerText)},blur:t.blur,keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"z",void 0,e.key,void 0)?null:e.ctrlKey?e.shiftKey||e.altKey||e.metaKey?null:t.undo.apply(null,arguments):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"z",void 0,e.key,void 0)?null:e.ctrlKey&&e.shiftKey?t.redo.apply(null,arguments):null}]}})])}),[],!1,null,"00675c90",null);e.default=component.exports},377:function(t,e,n){"use strict";n(313)},378:function(t,e,n){var o=n(102)(!1);o.push([t.i,'[contenteditable]:empty:after{content:"Hello world!";color:#999}.full-height{height:calc(100vh - 48px)}.ql-toolbar{display:none}.cool-shadow{box-shadow:0 2px 5px -1px rgba(50,50,93,.25),0 1px 3px -1px rgba(0,0,0,.3)}.hovered-tr{background-color:#f0f68c}.fixed-tr{background-color:#c8e6c9}.cursor-pointer{cursor:pointer}',""]),t.exports=o},383:function(t,e,n){"use strict";n.r(e);n(5),n(4),n(6),n(7);var o=n(33),r=n(32),c=n(34),l=n(44),d=n(0),h=(n(82),n(317),n(16),n(2),n(1),n(57),n(164),n(131),n(36),n(17),n(12),n(28),n(20),n(156),n(221),n(15),n(39),n(318),n(319),n(321),n(325),n(327),n(328),n(329),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(168),n(3),n(291)),f=n.n(h),v=n(381),m=n(352),y=n.n(m),w=n(353),x=n(382),k=(n(49),n(89),n(217),n(354)),O=n.n(k),T=["properties"];function S(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function C(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?S(Object(source),!0).forEach((function(e){Object(d.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):S(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function P(t){var e=O.a.create({baseURL:"https://ideality.app/api/notion/",headers:C({},t?{Authorization:"Bearer ".concat(t)}:{})});Object.assign(this,{createPage:function(t){return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,content,c,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.parent,r=t.properties,content=t.content,n.next=3,e.post("pages",C({parent:o},D({properties:r,content:content})));case 3:return c=n.sent,$(data=c.data),n.abrupt("return",data);case 7:case"end":return n.stop()}}),n)})))()},updatePage:function(t,n){return Object(o.a)(regeneratorRuntime.mark((function o(){var r,content,c,data;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=n.properties,content=n.content,o.next=3,e.patch("pages/".concat(t),D({properties:r,content:content}));case 3:return c=o.sent,$(data=c.data),o.abrupt("return",data);case 7:case"end":return o.stop()}}),o)})))()},deleteBlock:function(t){return Object(o.a)(regeneratorRuntime.mark((function n(){var o,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.delete("blocks/".concat(t));case 2:return o=n.sent,data=o.data,n.abrupt("return",data);case 5:case"end":return n.stop()}}),n)})))()},getPage:function(t){return Object(o.a)(regeneratorRuntime.mark((function n(){var o,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.get("pages/".concat(t));case 2:return o=n.sent,$(data=o.data),n.abrupt("return",data);case 6:case"end":return n.stop()}}),n)})))()},getUser:function(){return Object(o.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("No token provided. Please use an instance of Notion with a token.");case 2:return n.next=4,e.get("users/me");case 4:return n.abrupt("return",n.sent.data);case 5:case"end":return n.stop()}}),n)})))()},queryDatabase:function(t,n){return Object(o.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.post("databases/".concat(t,"/query"),n);case 2:return o.abrupt("return",o.sent.data.results.map((function(t){t.properties;var details=Object(x.a)(t,T);return $(t),C(C({},t.properties),{},{details:details})})));case 3:case"end":return o.stop()}}),o)})))()},getPageBy:function(t,filter){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object(h.keys)(filter)[0],c=filter[r],n.next=4,e.queryDatabase(t,{filter:{property:_.startCase(r),title:{equals:c}}});case 4:if(n.t1=o=n.sent,n.t0=null===n.t1,n.t0){n.next=8;break}n.t0=void 0===o;case 8:if(!n.t0){n.next=12;break}n.t2=void 0,n.next=13;break;case 12:n.t2=o[0];case 13:return n.abrupt("return",n.t2);case 14:case"end":return n.stop()}}),n)})))()},getBlock:function(t){var n=arguments,r=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var c,l,d,h,data;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=n.length>1&&void 0!==n[1]?n[1]:{},l=c.recurse,d=void 0!==l&&l,o.next=3,e.get("blocks/".concat(t));case 3:if(h=o.sent,data=h.data,!h.data.has_children){o.next=10;break}return o.next=9,r.getBlockChildren(t,{recurse:d});case 9:data.children=o.sent;case 10:return o.abrupt("return",data);case 11:case"end":return o.stop()}}),o)})))()},getBlockChildren:function(t){var n=arguments,r=this;return Object(o.a)(regeneratorRuntime.mark((function c(){var l,d,h,f,v;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return l=n.length>1&&void 0!==n[1]?n[1]:{},d=l.recurse,h=void 0!==d&&d,c.next=3,e.get("blocks/".concat(t,"/children"));case 3:if(f=c.sent,v=f.data.results,!h){c.next=8;break}return c.next=8,Promise.all(v.map(function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.has_children){t.next=5;break}return t.next=4,r.getBlockChildren(e.id,{recurse:h});case 4:e.children=t.sent;case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:return c.abrupt("return",v);case 9:case"end":return c.stop()}}),c)})))()}})}function D(t){var e=t.properties,content=t.content,n=[];return{properties:Object(h.chain)(e).mapValues((function(t,e){if("number"==typeof t)return{number:t};var o=t&&"object"===Object(l.a)(t);return o&&n.push(e),Object(d.a)({},"name"===e?"title":"rich_text",[{text:{content:o?JSON.stringify(t):t}}])})).mapKeys((function(t,e){return n.includes(e)&&(e+=" JSON"),e=_.startCase(e)})).value(),children:content.plain&&(content=("string"==typeof content.plain?content.plain:JSON.stringify(content.plain,null,2)).split(/\n+/),content.map((function(line){return{type:"paragraph",paragraph:{rich_text:[{type:"text",text:{content:line}}]}}})))}}function $(data){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"properties",e=[];data[t]=Object(h.chain)(data[t]).mapKeys((function(t,n){if((n=Object(h.camelCase)(n)).endsWith("Json")){n=n.replace(/Json$/,""),e.push(n)}return n})).mapValues((function(object,t){var n,o=function t(object){return null!=object&&object.type?t(object[object.type]):object}(object);["title","rich_text"].includes(object.type)&&(o=null===(n=o[0])||void 0===n?void 0:n.plain_text,e.includes(t)&&(o=JSON.parse(o||null)));return o})).value()}P.anon=new P;var j=P;function N(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function E(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(e){Object(d.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):N(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var z=f.a.findIndex;function I(){var t=Date.now();return{content:"",notes:"",created:t,id:Object(w.encode)(t),history:[{time:0,content:""}]}}var R={head:function(){var t,e="";return this.doc&&(e=(this.computeTitle(this.doc)||this.createdDateAndTime(null===(t=this.doc)||void 0===t?void 0:t.created))+" · "),{title:e+"Write.",link:[{rel:"icon",type:"image/x-icon",href:this.favicon||"./favicon.png",hid:"favicon"}]}},data:function(){return{mounted:!1,showSidebar:null,width:null,tempContent:null,workspaceTop:0,docs:null,doc:null,docChanged:!0,window:null,docTimer:null,idleTimer:null,historyPreview:null,historyPreviewFixed:!1,historyPreviewTimeout:null,showHistoryChart:!0,historyChart:null,autoStartDocTimer:!0,disableFormatting:!1,console:console,document:document,chartMode:1,chartAxes:["minutes","words"],saved:!0,saving:!1,showDocs:!1,favicon:null,settings:{notionKey:void 0,write:{syncWithNotion:!1,editor:{zoom:100}}},notion:null}},mounted:function(){var t=this,e=function(e){var n=localStorage.getItem(e),o=t.settings[e];console.log({key:e,localValue:n,defaultValue:o});var r="object"===Object(l.a)(o),c=Array.isArray(o);r&&(n=JSON.parse(n||null)),t.settings[e]=r&&!c?E(E({},o),n):n||o,t.$watch("settings."+e,{deep:!0,handler:function(t){localStorage.setItem(e,r?JSON.stringify(t):t)}})};for(var n in this.settings)e(n);this.docs=f()(localStorage).keys().filter((function(t){return t.startsWith("doc_")})).map((function(t){return JSON.parse(localStorage.getItem(t))})).value(),this.docs.length||(this.docs=[I()]),this.doc=E(E({},I()),f.a.find(this.docs,{id:this.$route.query.id||localStorage.getItem("lastDocId")})||this.docs[0]);var o=function(){t.width=window.innerWidth,t.workspaceTop=document.getElementById("workspace").offsetTop};window.addEventListener("resize",o),window.onbeforeunload=function(e){if(e.preventDefault(),!t.saved)return"You have unsaved changes. Are you sure you want to leave?"},console.log("beforeunload listener added"),this.window=window,this.mounted=!0,this.$nextTick((function(){o(),t.$watch("chartConfig",{immediate:!0,handler:function(t){var e=document.getElementById("history-chart");this.historyChart?(Object.assign(this.historyChart,t),this.historyChart.update()):this.historyChart=new v.a(e,t)}})}))},computed:{content:{get:function(){return(this.historyPreview||this.doc).content.trim()},set:function(t){(this.historyPreview||this.doc).content=t}},formattedContent:{get:function(){var content=this.content;return content=content.split("\n+").map((function(t){return"<p>".concat(t,"</p>")})).join("\n")||"<p></p>"},set:function(t){this.content=t.replace(/(?!\*\*)(<strong>.+?<\/strong>(?!\*\*))/g,"**$1**")}},docTimeAsHHMMSS:{get:function(){return this.timeAsHHMMSS(this.doc.time)},set:function(t){var e=this.doc;if(t.match(/^\d\d?:\d\d:\d\d$/)){var n=t.split(":"),o=Object(c.a)(n,3),r=o[0],l=o[1],d=o[2];e.time=3600*Number(r)+60*Number(l)+Number(d)}}},wordcount:function(){var content=(this.historyPreview||this.doc).content;return this.getWordcount(content)},chartConfig:function(){var t=this,e=this.doc,n=this.chartAxes,data=e.history.map((function(e){var time=e.time,content=e.content,n=t.getWordcount(content);return{minutes:time/60,words:n,wph:n/(time/3600)}}));return{type:"scatter",data:{datasets:[{label:"".concat(n[0]," vs ").concat(n[1]),backgroundColor:"rgba(54,162,235,0.2)",borderColor:"rgba(54,162,235,1)",data:Object(r.a)(null==data?void 0:data.map((function(t){return{x:t[n[0]],y:t[n[1]]}})))}]},options:{plugins:{legend:{display:!1}},animation:{duration:0},scales:{y:{min:0}},onHover:function(e,n){var o=Object(c.a)(n,1)[0];if(o){var r=t.doc.history[o.index];t.historyPreview=r}else{var l=t.historyPreview;setTimeout((function(){t.historyPreview==l&&(t.historyPreview=null)}),1e3)}}}}}},methods:{zoom:function(t){this.settings.write.editor.zoom+=t,this.$bvToast.toast("Zoom changed",{title:"".concat(this.settings.write.editor.zoom,"%"),variant:"success",autoHideDelay:500})},setFavicon:function(t){this.favicon=t},computeTitle:function(t){var e,n;return null==t||null===(e=t.content)||void 0===e||null===(n=e.match(/\w[\w\s-]*\w|\w/))||void 0===n?void 0:n[0]},createdDateAndTime:function(t){return new Date(t.created).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})},pruneHistory:function(){for(var t=this.doc.history,i=1;i<t.length;){t[i].time-t[i-1].time<(this.doc.time-t[0].time)/60?(this.$delete(t,i),this.saved=!1):(this.$set(t[i],"delta",this.withDelta("create",t[i-1].content,t[i].content)),i++)}},copyToClipboard:function(text){navigator.clipboard.writeText(text),this.$bvToast.toast("Copied to clipboard",{title:"Copied!",autoHideDelay:2e3,appendToast:!0,variant:"success"})},startDocTimer:function(){var t=this;void 0===this.doc.time&&this.$set(this.doc,"time",0),this.docTimer||(this.docTimer=setInterval((function(){t.doc.time+=1}),1e3),this.setFavicon("./red-play-button.png"))},timeAsHHMMSS:function(time){if(!time)return"--:--:--";var t=Math.floor(time/3600),e=Math.floor((time-3600*t)/60),n=time-3600*t-60*e;return"".concat(t,":").concat(e<10?"0":"").concat(e,":").concat(n<10?"0":"").concat(n)},removeComments:function(content){return content=(content=(content=(content=content.replace(/\/\*[\s\S]*?\*\//g,"")).replace(/^=+.+?=+$/gm,"")).replace(/\n{3,}/g,"\n\n")).trim()},getWordcount:function(content){var t;return null!==(t=content)&&void 0!==t&&t.trim()?(content=this.removeComments(content)).split(/[^\w-]+/).filter((function(t){return t.trim()})).length:0},withDelta:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var c=n.map((function(text){var t;return null===(t=new TextEncoder)||void 0===t?void 0:t.encode(text)})),l=y.a[t].apply(y.a,Object(r.a)(c)),d=(new TextDecoder).decode(Uint8Array.from(l));return d},save:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,time,content,r,c,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.saving){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t.saved=!1,t.saving=!0,n=t.doc,o=n.history||t.$set(n,"history",[]),time=n.time,content=n.content,o.push({time:time,content:content,delta:o.length&&t.withDelta("create",o[o.length-1].content,content)}),r=E(E({},n),{},{history:f.a.map(n.history,(function(t,i){return i?f.a.omit(t,"content"):t}))}),localStorage.setItem("doc_".concat(n.id),JSON.stringify(r)),!t.settings.write.syncWithNotion){e.next=21;break}return c=t.settings.write.notionDatabaseId,e.next=15,t.notion.getPageBy(c,{localId:n.id});case 15:return l=e.sent,d={properties:{name:t.computeTitle(n),localId:n.id,time:n.time,notes:n.notes},content:{plain:n.content}},console.log({page:l,dataToSave:d}),e.next=20,t.notion.createPage(E({parent:{database_id:c}},d));case 20:l&&t.notion.deleteBlock(l.details.id);case 21:console.log("Saved!"),t.$nextTick((function(){return t.saved=!0})),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(2),console.error(e.t0),t.$bvToast.toast("Error saving: "+JSON.stringify(e.t0,null,2),{title:"Error",autoHideDelay:2e3,appendToast:!0,variant:"danger"});case 29:return e.prev=29,t.saving=!1,e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[2,25,29,32]])})))()},newDoc:I,without:f.a.without,findIndex:z},watch:{"settings.notionKey":function(t,e){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!t){o.next=17;break}return console.log("Loading Notion data..."),n.notion=new j(t),o.prev=3,console.log("Athenticating..."),o.next=7,n.notion.getUser();case 7:console.log("Authenticated!"),o.next=17;break;case 10:o.prev=10,o.t0=o.catch(3),console.log("Authentication failed!"),n.notion=null,n.settings.notionKey=e,n.$bvToast.toast("Invalid Notion key",{title:"Error",autoHideDelay:2e3,appendToast:!0,variant:"danger"}),n.$bvModal.show("notion-sync-settings");case 17:case"end":return o.stop()}}),o,null,[[3,10]])})))()},"settings.write.syncWithNotion":function(t){t&&(this.settings.notionKey&&this.settings.write.notionDatabaseId||this.$bvModal.show("notion-sync-settings"))},"$route.query.id":function(t){this.doc=f.a.find(this.docs,{id:t})},"doc.id":{handler:function(){this.tempContent=this.doc.content,this.showDocs=!1,this.$nextTick((function(){var t;null===(t=document.getElementById("editor"))||void 0===t||t.focus()})),localStorage.setItem("lastDocId",this.doc.id);for(var t=this.doc.history,i=1;i<(null==t?void 0:t.length);i++){var e=[i-1,i].map((function(e){return t[e].content})),n=Object(c.a)(e,2),o=n[0],r=n[1],l=t[i].delta,d=void 0!==l,h=d?"content":"delta";try{var f=this.withDelta(d?"apply":"create",o,d?l:r);this.$set(t[i],h,f),this.$set(t[i],"wordcount",this.getWordcount(t[i].content))}catch(e){console.error(e),t.splice(i);break}}this.docChanged=!0}},"doc.content":{handler:function(){var t=this;this.doc;if(this.docChanged)return this.docChanged=!1,void(this.saved=!0);this.saved=!1,clearTimeout(this.idleTimer),this.idleTimer=setTimeout(this.save,5e3),this.autoStartDocTimer&&this.$nextTick((function(){return t.startDocTimer()}))}},docs:{handler:function(t){f()(localStorage).keys().filter((function(t){return t.startsWith("doc_")})).filter((function(e){return!t.find((function(t){return t.id===e.replace("doc_","")}))})).forEach((function(t){return localStorage.removeItem(t)}))}}}},A=R,F=(n(377),n(65)),component=Object(F.a)(A,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.doc?n("b-container",{staticClass:"px-0",staticStyle:{overflow:"hidden"},attrs:{fluid:""},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"s",void 0,e.key,void 0)?null:e.ctrlKey?(e.preventDefault(),t.save.apply(null,arguments)):null},function(e){return(e.type.indexOf("key")||187===e.keyCode)&&e.ctrlKey&&e.shiftKey?(e.preventDefault(),t.zoom(10)):null},function(e){return(e.type.indexOf("key")||189===e.keyCode)&&e.ctrlKey&&e.shiftKey?(e.preventDefault(),t.zoom(-10)):null}]}},[n("div",{staticClass:"d-flex justify-content-start align-items-center sticky-top pb-1 border"},[n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:t.showSidebar?"outline-secondary":"light"},on:{click:function(){return t.showSidebar=!t.showSidebar}}},[t._v("\n      ≡\n    ")]),t._v(" "),n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:t.docTimer?"outline-danger":"success"},on:{click:function(){t.docTimer?(t.window.clearInterval(t.docTimer),t.docTimer=null,t.saved=!1,t.setFavicon("./favicon.png")):t.startDocTimer()}}},[t._v("\n      "+t._s(t.docTimer?"Stop timer":"Start timer")+"\n    ")]),t._v(" "),n("b-form-input",{staticClass:"m-1",staticStyle:{"max-width":"100px"},attrs:{type:"text",size:"sm",variant:"outline-secondary"},model:{value:t.docTimeAsHHMMSS,callback:function(e){t.docTimeAsHHMMSS=e},expression:"docTimeAsHHMMSS"}}),t._v(" "),n("b-check",{staticClass:"m-1",attrs:{size:"sm",variant:"outline-secondary",switch:""},model:{value:t.autoStartDocTimer,callback:function(e){t.autoStartDocTimer=e},expression:"autoStartDocTimer"}},[t._v("\n      Start timer on input\n    ")]),t._v(" "),n("b-check",{staticClass:"m-1",attrs:{size:"sm",variant:"outline-secondary",switch:""},model:{value:t.settings.write.syncWithNotion,callback:function(e){t.$set(t.settings.write,"syncWithNotion",e)},expression:"settings.write.syncWithNotion"}},[n("span",{on:{contextmenu:function(e){return e.preventDefault(),t.$refs.notionSyncSettings.show()}}},[t._v("\n        Sync with Notion\n      ")])]),t._v(" "),n("b-modal",{ref:"notionSyncSettings",attrs:{id:"notion-sync-settings",size:"sm",title:"Notion sync settings","hide-footer":"",centered:""},on:{hidden:function(e){t.settings.notionKey&&t.settings.write.notionDatabaseId||(t.settings.write.syncWithNotion=!1)}}},[n("b-form-group",{attrs:{label:"Notion API key","label-for":"notionApiKey"}},[n("b-input",{attrs:{lazy:"",id:"notionApiKey",size:"sm",type:"text",placeholder:"Enter your Notion API key"},model:{value:t.settings.notionKey,callback:function(e){t.$set(t.settings,"notionKey",e)},expression:"settings.notionKey"}})],1),t._v(" "),n("b-form-group",{attrs:{label:"Notion database ID","label-for":"notionDatabaseId"}},[n("b-input",{attrs:{id:"notionDatabaseId",size:"sm",type:"text",placeholder:"Enter your Notion database ID"},model:{value:t.settings.write.notionDatabaseId,callback:function(e){t.$set(t.settings.write,"notionDatabaseId",e)},expression:"settings.write.notionDatabaseId"}})],1),t._v(" "),t.settings.notionKey&&t.settings.write.notionDatabaseId?n("p",{staticClass:"text-success small"},[t._v("\n        To open this modal again in the future, right-click the “Sync with Notion” switch.\n      ")]):t._e()],1)],1),t._v(" "),n("b-row",{staticClass:"full-height m-0",style:{"--full-height":"calc(100vh - "+t.workspaceTop+"px)"},attrs:{id:"workspace"}},[n("b-col",{directives:[{name:"show",rawName:"v-show",value:t.showSidebar,expression:"showSidebar"}],class:{"position-absolute":t.width<768,"cool-shadow bg-white full-height p-2":!0},style:{opacity:t.width<768&&.9,overflowY:"auto",fontSize:"0.7em",zIndex:1},attrs:{cols:"8",md:"5",lg:"4",xl:"3"}},[n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:"light"},on:{click:function(e){t.doc=t.newDoc(),t.docs=t.docs.concat([t.doc])}}},[t._v("\n        🗎\n      ")]),t._v(" "),n("b-button",{staticClass:"m-1",attrs:{size:"sm",variant:t.showDocs?"outline-secondary":"light"},on:{click:function(){return t.showDocs=!t.showDocs}}},[t._v("\n        "+t._s(t.showDocs?"🗀":"🗁")+"\n      ")]),t._v(" "),t.showDocs?t._l(t.docs,(function(e,o){return n("b-row",{key:o,staticClass:"m-0"},[n("b-col",{staticClass:"p-2",style:Object.assign({},{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},!e.content.trim()&&{"font-style":"italic",color:"#868686"},e===t.doc&&{"font-weight":"bold"}),attrs:{cols:"9"}},[n("nuxt-link",{staticClass:"text-secondary",attrs:{to:{query:{id:e.id}}},domProps:{textContent:t._s(t.computeTitle(e)||t.createdDateAndTime(e))}})],1),t._v(" "),n("b-col",[t.docs.length>1?n("b-button-close",{attrs:{size:"sm"},on:{click:function(n){t.window.confirm("Are you sure? THERE IS NO UNDO!")&&(t.doc=t.docs[o-1]||t.docs[o+1]||null,t.docs=t.without(t.docs,e))}}}):t._e()],1)],1)})):t._e(),t._v(" "),t.doc.history&&t.doc.history.length?[n("h5",{staticClass:"mt-4"},[t._v("\n          Revision history\n        ")]),t._v(" "),n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:function(e){t.showHistoryChart=!t.showHistoryChart}}},[t._v("\n          "+t._s(t.showHistoryChart?"Table":"Chart")+"\n        ")]),t._v(" "),t.showHistoryChart?n("b-select",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary",options:[{value:["minutes","words"],text:"X: minutes, Y: words"},{value:["minutes","wph"],text:"X: minutes, Y: words per hour"},{value:["words","wph"],text:"X: words, Y: words per hour"}]},model:{value:t.chartAxes,callback:function(e){t.chartAxes=e},expression:"chartAxes"}}):t._e(),t._v(" "),n("canvas",{style:{display:t.showHistoryChart?"block":"none"},attrs:{id:"history-chart"}}),t._v(" "),t.showHistoryChart?t._e():n("b-table",{attrs:{"sort-by":"time","sort-desc":"",items:t.doc.history,fields:[{key:"time",label:"Time",formatter:t.timeAsHHMMSS},{key:"wordcount",label:"Words"},{key:"remove",label:""}],"tbody-tr-class":function(e){return"cursor-pointer "+(t.historyPreview===e?t.historyPreviewFixed?"fixed-tr":"hovered-tr":"")}},on:{"row-clicked":function(e){t.historyPreviewFixed&&t.historyPreview==e?(t.historyPreview=null,t.historyPreviewFixed=!1):(t.historyPreview=e,t.historyPreviewFixed=!0)},"row-hovered":function(e){t.historyPreviewFixed||(t.historyPreview=e,t.window.clearTimeout(t.historyPreviewTimeout))},"row-unhovered":function(e){t.historyPreviewTimeout=t.window.setTimeout((function(){t.historyPreviewFixed||t.historyPreview!==e||(t.historyPreview=null)}),1e3)}},scopedSlots:t._u([{key:"cell(remove)",fn:function(e){var o=e.item;return[t.doc.history.indexOf(o)>0?n("b-button-close",{attrs:{size:"sm"},on:{click:function(){if(t.window.confirm("Are you sure? THERE IS NO UNDO!")){var i=t.doc.history.indexOf(o);t.doc.history=t.without(t.doc.history,o),i<t.doc.history.length&&t.$set(t.doc.history[i],"delta",t.withDelta("create",t.doc.history[i-1].content,t.doc.history[i].content)),t.saved=!1}}}}):t._e()]}}],null,!1,1813993722)}),t._v(" "),n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:function(e){t.window.confirm("Are you sure? THERE IS NO UNDO!")&&(t.doc.history=[])}}},[t._v("\n          Clear history\n        ")]),t._v(" "),n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:function(e){t.copyToClipboard("hours\twords\n"+t.doc.history.map((function(e){return e.time/3600+"\t"+t.getWordcount(e.content)})).join("\n"))}}},[t._v("\n          Copy as TSV\n        ")]),t._v(" "),n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:t.pruneHistory}},[t._v("\n          Prune history\n        ")])]:t._e()],2),t._v(" "),n("b-col",{staticClass:"full-height bg-light pt-4",staticStyle:{overflow:"auto"}},[n("div",{style:{maxWidth:"900px",margin:"0 auto"}},[n("Editor",t._b({attrs:{value:(t.historyPreview||t.doc).content,refresh:t.historyPreview&&t.historyPreview.time||t.doc.id,readonly:t.historyPreview},on:{input:function(e){!t.historyPreview&&(t.doc.content=e)}}},"Editor",Object.assign({},{disableFormatting:t.disableFormatting},t.settings.write.editor),!1)),t._v(" "),n("div",{staticClass:"d-flex justify-content-start align-items-center sticky-top px-2 py-1 border",staticStyle:{gap:"1rem"}},[n("b-check",{attrs:{size:"sm",variant:"outline-secondary",switch:""},model:{value:t.disableFormatting,callback:function(e){t.disableFormatting=e},expression:"disableFormatting"}},[t._v("\n            Disable formatting\n          ")]),t._v(" "),n("b-button",{attrs:{size:"sm",variant:"outline-secondary"},on:{click:function(e){t.copyToClipboard(t.removeComments((t.historyPreview||t.doc).content))}}},[t._v("\n            Copy\n          ")]),t._v(" "),n("b-button",{attrs:{size:"sm",variant:t.saved||t.saving?"light":"outline-danger",disabled:t.saved||t.saving},on:{click:t.save}},[t._v("\n            "+t._s(t.saved?"All changes saved.":t.saving?"Saving...":"Save")+"\n          ")]),t._v(" "),n("b-modal",{attrs:{id:"notes-modal",size:"lg",title:"Notes",centered:"","hide-footer":!0}},[n("b-textarea",{attrs:{rows:"10"},model:{value:t.doc.notes,callback:function(e){t.$set(t.doc,"notes",e)},expression:"doc.notes"}})],1),t._v(" "),n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.notes-modal",modifiers:{"notes-modal":!0}}],attrs:{size:"sm",variant:"outline-secondary"}},[t._v("\n            Notes\n          ")]),t._v(" "),t.historyPreview&&t.historyPreviewFixed?n("b-button",{staticClass:"mt-2",attrs:{size:"sm",variant:"outline-secondary"},on:{click:function(e){t.historyPreview=null,t.historyPreviewFixed=!1}}},[t._v("\n            Exit preview\n          ")]):t._e(),t._v(" "),n("div",{staticClass:"small ml-auto text-muted"},[t._v("\n            "+t._s(t.wordcount)+" "+t._s(1===t.wordcount?"word":"words")+"\n            "),t._v("\n            ~"+t._s(10*Math.round(t.wordcount/(t.historyPreview||t.doc).time*3600/10))+" words/hour\n          ")])],1)],1)])],1)],1):t._e()}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{Editor:n(316).default})}}]);